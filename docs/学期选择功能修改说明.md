# 学期选择功能修改说明

## 修改概述

根据用户需求，对选课管理和成绩录入两个界面的学期选择方式进行了差异化处理，**无需创建新的API，完全复用现有API**：

### 1. 选课管理界面（EnrollmentManagement.vue）
- **功能**：用户可以输入学期，选课时传入学期参数
- **特点**：支持输入新学期值，通过选课API关联学期
- **学期来源**：从已选课数据中动态提取学期列表

### 2. 成绩录入界面（GradeInput.vue）
- **功能**：只能选择已存在的学期（从成绩数据中提取）
- **特点**：不支持创建新学期，只能从现有学期中选择
- **学期来源**：从已录入的成绩数据中动态提取学期列表

## 核心逻辑

### 选课管理界面

**学期选择逻辑**：
```typescript
// 从已选学生中提取学期
const semesterOptions = computed(() => {
  const semesters = new Set<string>()
  enrolledStudents.value.forEach((student: any) => {
    if (student.semester) {
      semesters.add(student.semester)
    }
  })
  return Array.from(semesters).map(semester => ({
    name: formatSemesterName(semester),
    value: semester
  }))
})
```

**选课时传入学期**：
```typescript
// 在选课API中传入学期参数
await courseStore.enrollStudentToCourseWithSemester(courseId, sid, semester)
```

**选课API扩展**：
```typescript
// 扩展现有选课API以支持学期参数
const enrollStudentWithSemester = (courseId: string, studentId: string, semester: string) => {
  return request.post(`/courses/${courseId}/enroll`, { studentId, semester })
}
```

### 成绩录入界面

**学期选择逻辑**：
```typescript
// 从已录入的成绩中提取学期
const semesterOptions = computed(() => {
  const semesters = new Set<string>()
  gradeStore.courseGrades.forEach((grade: any) => {
    if (grade.semester) {
      semesters.add(grade.semester)
    }
  })
  return Array.from(semesters).map(semester => ({
    name: formatSemesterName(semester),
    value: semester
  }))
})
```

## 复用的现有API

### 选课相关API
```
POST   /api/courses/:id/enroll     - 学生选课（支持传入学期参数）
GET    /api/courses/:id/students   - 获取选课学生列表（包含学期信息）
DELETE /api/courses/:id/enroll/:studentId - 取消选课
```

### 成绩相关API
```
GET    /api/grades/course/:courseId - 获取课程成绩列表（包含学期信息）
POST   /api/grades                 - 录入成绩（支持学期参数）
```

## 数据流程

### 选课流程
1. 用户选择课程
2. 系统读取该课程的已选学生列表（包含学期信息）
3. 从已选学生中提取学期列表，显示在学期下拉框
4. 用户选择或输入学期
5. 用户选择学生，点击选课
6. **选课API传入学期参数**：`POST /api/courses/:id/enroll {studentId, semester}`
7. 选课成功，数据包含学期信息

### 成绩录入流程
1. 用户选择课程
2. 系统读取该课程的成绩数据（包含学期信息）
3. 从成绩数据中提取学期列表，显示在学期下拉框
4. 用户选择学期
5. 系统加载该课程在该学期的选课学生
6. 用户录入成绩（成绩数据自动包含学期信息）

## 学期格式规范

建议使用以下格式：
- `2024-2025-1` → 2024-2025学年第一学期
- `2024-2025-2` → 2024-2025学年第二学期
- `2025-2026-1` → 2025-2026学年第一学期

## 修改的文件

### 1. 选课管理界面 (`src/views/students/EnrollmentManagement.vue`)
- 修改学期选择为动态从选课数据提取
- 修改选课方法，传入学期参数
- 删除独立的学期管理逻辑

### 2. 成绩录入界面 (`src/views/grades/GradeInput.vue`)
- 修改学期选择为动态从成绩数据提取
- 删除独立的学期管理逻辑

### 3. 课程Store (`src/stores/course.ts`)
- 新增 `enrollStudentToCourseWithSemester` 方法
- 扩展现有选课API以支持学期参数

## 优势

1. **无需新API**：完全复用现有选课和成绩API
2. **数据一致性**：学期信息直接来自选课和成绩数据
3. **自动管理**：无需手动创建/删除学期，数据自然流动
4. **简化逻辑**：减少代码复杂度，降低维护成本

## 注意事项

1. **后端支持**：需要确保选课API支持传入学期参数
2. **数据完整性**：确保选课和成绩数据都包含学期字段
3. **用户体验**：提供清晰的提示，帮助用户理解学期选择逻辑

## 测试要点

1. 测试选课时传入学期参数的功能
2. 测试从选课数据中正确提取学期列表
3. 测试从成绩数据中正确提取学期列表
4. 验证学期名称格式化的正确性
5. 检查数据一致性