# 成绩批量删除功能测试说明

## 功能概述
在成绩查询界面中添加了批量删除功能，允许管理员和教师用户一次性删除多条成绩记录。

## 实现方式
- **不添加新的 API**：通过多次调用现有的 `gradeStore.removeGrade()` 方法实现
- **逐个删除**：使用循环逐个删除选中的记录
- **批量反馈**：删除完成后显示批量操作结果

## 功能特点

### 1. 权限控制
- 仅管理员和教师可见批量删除按钮
- 学生用户无法看到该功能

### 2. 按钮状态管理
- 当未选择任何记录时，按钮处于禁用状态
- 按钮上显示当前选中的记录数量

### 3. 操作流程
1. 用户在表格中勾选要删除的成绩记录
2. 点击"批量删除"按钮
3. 弹出确认对话框，显示要删除的记录数量
4. 用户确认后开始逐个删除
5. 显示加载状态
6. 删除完成后显示结果统计

### 4. 错误处理
- 如果部分记录删除失败，会显示成功和失败的数量
- 失败的记录会显示具体信息（学生姓名 - 课程名称）
- 即使部分失败，也会继续处理其他记录

### 5. 用户体验优化
- 使用 silent 模式调用删除 API，避免重复显示成功消息
- 删除完成后自动清空选择状态
- 删除完成后自动刷新数据列表
- 使用 Element Plus 的消息提示提供清晰的反馈

## 代码修改点

### 1. 模板部分
```vue
<!-- 添加批量删除按钮 -->
<el-button 
  type="danger" 
  @click="batchDelete" 
  :icon="Delete" 
  :disabled="selectedRows.length === 0"
  v-if="authStore.isAdmin || authStore.isTeacher"
>
  批量删除 ({{ selectedRows.length }})
</el-button>
```

### 2. 脚本部分
```typescript
// 批量删除成绩
const batchDelete = async () => {
  if (selectedRows.value.length === 0) {
    ElMessage.warning('请先选择要删除的成绩')
    return
  }

  try {
    await ElMessageBox.confirm(
      `确定要批量删除选中的 ${selectedRows.value.length} 条成绩记录吗？`,
      '批量删除警告',
      {
        type: 'warning',
        confirmButtonText: '确定删除',
        cancelButtonText: '取消'
      }
    )

    // 显示加载状态
    gradeStore.loading = true

    // 逐个删除选中的记录
    let successCount = 0
    let failCount = 0
    const failMessages: string[] = []

    for (const row of selectedRows.value) {
      try {
        // 使用 silent 模式避免重复显示成功消息
        await gradeStore.removeGrade(row.id, true)
        successCount++
      } catch (error) {
        failCount++
        failMessages.push(`${row.studentName} - ${row.courseName}`)
      }
    }

    // 显示结果
    if (failCount === 0) {
      ElMessage.success(`批量删除成功：${successCount} 条记录`)
    } else {
      ElMessage.warning(`批量删除完成：成功 ${successCount} 条，失败 ${failCount} 条`)
      if (failMessages.length > 0) {
        ElMessage.info(`失败记录：${failMessages.join('、')}`)
      }
    }

    // 清空选择
    selectedRows.value = []
    
    // 重新加载数据
    await loadGrades()

  } catch (cancel) {
    // 用户取消
  } finally {
    gradeStore.loading = false
  }
}
```

## 测试步骤

### 1. 基础功能测试
1. 使用管理员或教师账号登录
2. 进入成绩查询界面
3. 查询出一些成绩记录
4. 勾选多条记录
5. 点击批量删除按钮
6. 确认删除
7. 验证记录是否被正确删除

### 2. 权限测试
1. 使用学生账号登录
2. 进入成绩查询界面
3. 验证批量删除按钮不可见

### 3. 边界情况测试
1. 未选择任何记录时，按钮应为禁用状态
2. 选择记录后，按钮应显示正确数量
3. 取消删除操作，记录应保持不变
4. 部分删除失败时，应正确显示统计信息

### 4. 并发测试
1. 选择多条记录进行批量删除
2. 验证加载状态正确显示
3. 验证删除完成后状态正确重置

## 注意事项
- 该功能通过多次 API 调用实现，可能对服务器造成一定压力
- 建议在删除大量记录时考虑分批处理
- 删除操作不可逆，请谨慎操作