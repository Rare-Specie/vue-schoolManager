# 成绩多选删除功能说明

## 功能概述

在成绩录入页面（GradeInput.vue）中新增了多选删除功能，允许用户：
1. 通过复选框选择多个学生
2. 批量删除选中学生的成绩记录
3. 单独删除单个学生的成绩记录

## 使用方法

### 1. 多选删除
1. 选择课程并加载学生数据
2. 在表格中勾选要删除成绩的学生（使用左侧的复选框）
3. 点击"删除选中 (X)"按钮
4. 确认删除操作
5. 系统将批量删除选中学生的成绩

### 2. 清除选择
- 当有选中的学生时，会显示"清除选择"按钮
- 点击该按钮可以清除所有已选中的复选框

### 3. 单独删除
- 在操作列中，对已有成绩的记录会显示"删除"按钮
- 点击该按钮可以单独删除该学生的成绩

## 新增功能组件

### 表格增强
```vue
<el-table
  ref="tableRef"
  :data="gradeStore.courseGrades"
  @selection-change="handleSelectionChange"
>
  <el-table-column type="selection" width="55" align="center" />
  <!-- 其他列 -->
</el-table>
```

### 操作按钮
```vue
<!-- 批量删除按钮 -->
<el-button 
  type="danger" 
  @click="batchDeleteGrades" 
  :icon="Delete" 
  :disabled="selectedRows.length === 0"
>
  删除选中 ({{ selectedRows.length }})
</el-button>

<!-- 清除选择按钮 -->
<el-button 
  v-if="selectedRows.length > 0"
  @click="clearSelection"
  :icon="Refresh"
>
  清除选择
</el-button>
```

## 新增函数

### 1. handleSelectionChange(selection)
- **功能**: 处理表格选择变化
- **参数**: selection - 选中的行数据数组
- **作用**: 更新 selectedRows 状态

### 2. clearSelection()
- **功能**: 清除所有选择
- **作用**: 清空选中状态并重置表格选择

### 3. batchDeleteGrades()
- **功能**: 批量删除选中学生的成绩
- **流程**:
  1. 验证是否有选中的学生
  2. 过滤出有成绩记录的学生
  3. 弹出确认对话框
  4. 调用 store 的批量删除API
  5. 从本地数据中移除已删除的记录
  6. 显示删除结果

### 4. deleteSingleGrade(row, index)
- **功能**: 删除单个学生的成绩
- **参数**: 
  - row: 学生行数据
  - index: 行索引
- **流程**:
  1. 验证是否有成绩记录
  2. 弹出确认对话框
  3. 调用 store 的删除API
  4. 从本地数据中移除记录

## Store 增强

### 新增 API 函数
```typescript
// 批量删除成绩
export const batchDeleteGrades = (ids: string[]): Promise<{ success: number; failed: number }> => {
  return request.post('/grades/batch-delete', { ids })
}
```

### 新增 Store 函数
```typescript
// 批量删除成绩
const batchRemoveGrades = async (ids: string[]) => {
  // 使用批量删除API
  const result = await batchDeleteGrades(ids)
  // 从列表中移除已删除的成绩
  grades.value = grades.value.filter(g => !ids.includes(g.id))
  return result
}

// 删除成绩（支持静默模式）
const removeGrade = async (id: string, silent: boolean = false) => {
  // silent参数控制是否显示提示消息
}
```

## 错误处理

1. **无选中项**: 显示警告消息
2. **无成绩记录**: 显示警告消息
3. **删除失败**: 
   - 批量删除失败时，会尝试逐个删除
   - 显示失败列表
4. **网络错误**: 显示错误提示

## 安全考虑

1. **确认对话框**: 所有删除操作都需要用户确认
2. **不可恢复**: 明确提示操作不可恢复
3. **权限检查**: 依赖后端API的权限验证

## 调试功能

页面保留了调试按钮，可以：
- 查看课程信息
- 验证课程ID映射
- 导出课程数据

## 注意事项

1. **数据同步**: 删除操作会同步更新本地数据
2. **选中状态**: 删除后会自动清除相关选中状态
3. **性能优化**: 批量删除使用Promise.all并行处理
4. **用户体验**: 提供详细的操作反馈

## 后端API要求

需要后端提供以下API端点：
- `DELETE /grades/{id}` - 删除单个成绩
- `POST /grades/batch-delete` - 批量删除成绩

请求格式：
```json
{
  "ids": ["id1", "id2", "id3"]
}
```

响应格式：
```json
{
  "success": 3,
  "failed": 0
}
```

## 测试建议

1. **基础测试**:
   - 选择有成绩的学生进行删除
   - 选择无成绩的学生进行删除
   - 混合选择进行批量删除

2. **边界测试**:
   - 不选择任何学生点击删除
   - 选择所有学生进行删除
   - 删除后立即重新加载数据

3. **错误测试**:
   - 网络断开时的删除
   - 后端API返回错误时的处理
   - 重复删除同一成绩