# 登录错误处理优化说明

## 问题描述
登录时如果出现错误，网页上会显示非常多的错误信息，影响用户体验。

## 优化方案

### 1. 简化错误提示层级
**修改文件**: `src/stores/api/request.ts`

**优化前**:
- 多层错误处理：store层 + request层 + 组件层
- 错误信息重复显示
- 包含技术细节的错误堆栈

**优化后**:
- 统一在request.ts中处理错误
- 登录失败只显示简洁的错误信息
- 移除重复的错误提示

### 2. 登录接口特殊处理
```typescript
// 登录失败时只显示简洁的错误信息
if (status === 401 && config?.url === '/auth/login') {
  authStore.handleLogout()
  ElMessage.error('用户名或密码错误')
}
```

### 3. 移除不必要的错误重定向
**修改文件**: `src/stores/api/request.ts`
- 移除了 `window.location.href = '/'` 强制刷新
- 避免页面跳转导致的额外错误

### 4. 优化store错误处理
**修改文件**: `src/stores/auth.ts`
```typescript
catch (error) {
  // 错误提示已在request.ts中处理，这里只抛出错误
  throw error
}
```

## 优化效果

### 错误提示对比

**优化前**:
```
❌ 登录失败，请检查用户名或密码
❌ 请求失败，请稍后重试
❌ 网络错误
❌ 401 Unauthorized
❌ (可能还有更多...)
```

**优化后**:
```
❌ 用户名或密码错误
```

### 用户体验改进
1. ✅ 只显示一个简洁的错误提示
2. ✅ 不会刷新页面
3. ✅ 保持表单数据
4. ✅ 错误信息清晰易懂
5. ✅ 可以立即重新输入

## 技术细节

### 错误处理流程
```
用户登录 → API请求 → 服务器返回401 → request.ts捕获 → 显示简洁错误 → 保持在登录页面
```

### 关键修改点
1. `request.ts`: 统一错误处理，登录接口特殊处理
2. `auth.ts`: 移除重复的错误提示
3. `LoginView.vue`: 优化错误捕获逻辑

## 测试建议
1. 输入错误密码测试
2. 输入不存在的用户名测试
3. 网络异常测试
4. 服务器错误测试

所有测试应该只显示一个简洁的错误提示，不会刷新页面。