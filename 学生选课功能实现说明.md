# 学生选课功能实现说明

## 概述

本次更新为学生成绩管理系统添加了学生选课功能，允许管理员、教师和学生在成绩界面进行学生选课管理。

## 修改的文件

### 1. GradeInput.vue（成绩录入界面）

#### 新增功能：
- **学生选择区域**：在课程选择下方添加了学生选课管理区域
- **选课操作**：
  - 选择学生并添加到当前课程
  - 从当前课程中移除学生
  - 查看已选学生列表
- **已选学生对话框**：显示当前课程的所有选课学生，支持移除操作

#### 界面元素：
- 学生选择下拉框
- 添加选课按钮（仅管理员/教师可见）
- 取消选课按钮（仅管理员/教师可见）
- 查看已选学生按钮
- 已选学生列表对话框

### 2. GradeQuery.vue（成绩查询界面）

#### 新增功能：
- **学生选课区域**：在查询条件下方添加了学生选课管理区域
- **选课操作**：
  - 选择课程和学生进行选课
  - 查看已选学生列表
  - 从课程中移除学生

#### 界面元素：
- 课程选择下拉框
- 学生选择下拉框
- 添加选课按钮（仅管理员/教师可见）
- 查看已选学生按钮
- 已选学生列表对话框

### 3. course.ts（课程API）

#### 新增API函数：
```typescript
// 学生选课
export const enrollStudent = (courseId: string, studentId: string): Promise<any>

// 取消选课
export const unenrollStudent = (courseId: string, studentId: string): Promise<any>
```

### 4. course.ts（课程Store）

#### 新增方法：
```typescript
// 学生选课
const enrollStudentToCourse = async (courseId: string, studentId: string) => {
  try {
    await enrollStudent(courseId, studentId)
    ElMessage.success('选课成功')
    // 刷新选课学生列表
    if (currentCourse.value && currentCourse.value.id === courseId) {
      await fetchCourseStudents(courseId)
    }
    return true
  } catch (error) {
    ElMessage.error('选课失败')
    throw error
  }
}

// 取消选课
const unenrollStudentFromCourse = async (courseId: string, studentId: string) => {
  try {
    await unenrollStudent(courseId, studentId)
    ElMessage.success('取消选课成功')
    // 刷新选课学生列表
    if (currentCourse.value && currentCourse.value.id === courseId) {
      await fetchCourseStudents(courseId)
    }
    return true
  } catch (error) {
    ElMessage.error('取消选课失败')
    throw error
  }
}
```

## 功能特点

### 1. 权限控制
- 仅管理员和教师可以进行选课操作
- 学生只能查看选课信息

### 2. 数据同步
- 选课操作后自动刷新成绩列表
- 移除学生时自动清除相关成绩记录

### 3. 用户体验
- 清晰的操作按钮和状态提示
- 确认对话框防止误操作
- 实时反馈操作结果

### 4. 数据验证
- 必须先选择课程才能进行选课
- 必须选择学生才能添加选课
- 移除学生时需要确认

## 使用流程

### 在成绩录入界面：
1. 选择课程
2. 在"学生选课管理"区域选择学生
3. 点击"添加选课"将学生加入课程
4. 点击"查看已选学生"查看当前课程的所有学生
5. 在已选学生列表中可以移除学生

### 在成绩查询界面：
1. 在"学生选课管理"区域选择课程和学生
2. 点击"添加选课"进行选课
3. 点击"查看已选学生"查看选课情况

## 技术实现

### 前端技术栈：
- Vue 3 + TypeScript
- Element Plus UI组件库
- Pinia状态管理

### API交互：
- 使用现有的RESTful API接口
- 通过Pinia store封装业务逻辑
- 统一的错误处理和用户反馈

### 数据流：
```
用户操作 → Store方法 → API调用 → 后端处理 → 返回结果 → 更新UI
```

## 注意事项

1. **权限要求**：只有管理员和教师可以进行选课操作
2. **数据依赖**：需要先加载课程和学生列表
3. **操作确认**：移除学生时需要确认，避免误操作
4. **数据一致性**：选课操作会自动刷新相关数据

## 后续优化建议

1. 添加批量选课功能
2. 支持按班级批量选课
3. 添加选课时间限制
4. 优化已选学生列表的搜索和筛选功能
5. 添加选课统计功能