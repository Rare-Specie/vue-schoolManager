# 成绩录入功能修复验证

## 修复内容

根据错误日志和用户要求，修复了GradeInput.vue中的成绩保存逻辑：

### 问题分析
- **错误**: POST `/api/grades` 返回409冲突
- **原因**: 成绩已存在，但代码尝试创建而非更新
- **背景**: 所有成绩已被预设为0

### 修复方案

#### 1. 单个成绩保存 (`saveSingleGrade`)
**修复前**: 逻辑复杂，先尝试创建，失败后再查找并更新
**修复后**: 
- 如果有`gradeId`，直接使用更新API
- 如果没有`gradeId`，先查找是否已存在记录
  - 存在 → 使用更新API
  - 不存在 → 使用创建API
- 如果创建失败返回409，自动重试为更新操作

#### 2. 批量成绩保存 (`saveAllGrades`)
**修复前**: 循环中混用创建和更新，逻辑复杂
**修复后**:
- 先获取课程所有成绩，建立查找表
- 为每个学生构建独立的操作函数
- 按用户要求：批量操作仅需多次发送API
- 每个操作独立处理409错误

### 核心改进

1. **优先使用更新API**: 因为成绩已被预设为0，大部分情况应使用更新
2. **简化逻辑**: 参考GradeQuery.vue的编辑功能实现
3. **错误处理**: 409错误自动转换为更新操作
4. **批量操作**: 按用户要求，多次发送API而非批量接口

### 与GradeQuery.vue的一致性

GradeQuery.vue的编辑功能使用：
```typescript
await gradeStore.updateGradeInfo(editDialog.value.currentId, {
  score: editDialog.value.form.score
})
```

我们的修复也采用相同策略，确保逻辑一致。

## 验证步骤

1. 选择课程并加载学生
2. 修改部分学生成绩
3. 点击"保存"按钮
4. 应该看到成功提示，无409错误
5. 点击"保存所有成绩"
6. 应该批量保存成功

## 预期结果

- ✅ 单个保存：成功更新成绩
- ✅ 批量保存：多次API调用，全部成功
- ✅ 409错误：自动转换为更新操作
- ✅ 状态更新：表格中的"已保存"标签正确显示
